==============================================================
File content for: \index.html
==============================================================
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Presence Simulator Settings</title>
  <script type="text/javascript" src="/homey.js" data-origin="settings"></script>
  <link rel="stylesheet" href="./css/styles.css">
</head>

<body>

  <h1>Presence Simulator Settings</h1>

  <div id="statusMessage" class="status"></div>

  <!-- Confirm Modal -->
  <div id="confirmModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-title" id="modalTitle">Confirm</div>
      <div class="modal-message" id="modalMessage"></div>
      <div class="modal-buttons">
        <button class="secondary" onclick="closeModal(false)">Cancel</button>
        <button onclick="closeModal(true)">Confirm</button>
      </div>
    </div>
  </div>

  <!-- All Events Modal -->
  <div id="eventsModal" class="modal-overlay">
    <div class="modal-content modal-large">
      <div class="modal-title" id="eventsModalTitle">All Events</div>
      <div id="eventsModalContent" class="events-modal-content"></div>
      <div class="modal-buttons">
        <button onclick="closeEventsModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Vacation Mode Toggle -->
  <div class="card">
    <h2>üéØ Presence Simulator</h2>
    <div class="info-box">
      Enable Presence Simulator to start replaying recorded patterns
    </div>
    <label class="toggle-label">
      <label class="switch">
        <input type="checkbox" id="vacationMode" onchange="toggleVacationMode()">
        <span class="slider"></span>
      </label>
      <span class="status-text">Simulator is <span id="vacationStatus">OFF</span></span>
    </label>
  </div>

  <!-- Add Devices -->
  <div class="card">
    <h2>‚ûï Add Devices to Track</h2>
    <div class="info-box">
      Select one or more devices to start tracking their on/off patterns
    </div>
    <div id="deviceSelectorList" class="device-selector-list"></div>
    <button onclick="addSelectedDevices()">Add Selected Devices (<span id="selectedCount">0</span>)</button>
  </div>

  <!-- Tracked Devices -->
  <div class="card">
    <h2>üì± Tracked Devices</h2>
    <div id="trackedDevices" class="device-list">
      <p class="text-muted">No devices tracked yet</p>
    </div>
  </div>

  <!-- Debug Section -->
  <div id="debugSection" class="debug-section" style="display: none;">
    <div class="card">
      <h2>üêõ Debug Tools</h2>
      <div class="info-box">
        Development tools for troubleshooting
      </div>
      <button onclick="viewAllEventsDebug()">View All Events</button>
      <button onclick="exportData()" class="secondary">Export Data</button>
      <div id="debugOutput" style="margin-top: 15px;"></div>
    </div>

    <div class="card">
      <h2>üìù Application Logs</h2>
      <div class="info-box">
        View real-time application logs for debugging
      </div>
      <div class="log-controls">
        <button onclick="viewLogs()">Refresh Logs</button>
        <button onclick="toggleAutoRefresh()" id="autoRefreshBtn" class="secondary">Enable Auto-refresh</button>
        <button onclick="clearLogDisplay()" class="secondary">Clear Display</button>
        <button onclick="copyLogs()" class="secondary">Copy Logs</button>
      </div>
      <div id="logViewer" class="log-viewer" style="display: none;"></div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="./js/utils.js"></script>
  <script src="./js/modals.js"></script>
  <script src="./js/settings.js"></script>
  <script src="./js/device-selector.js"></script>
  <script src="./js/tracked-devices.js"></script>
  <script src="./js/test-data.js"></script>
  <script src="./js/debug.js"></script>
  <script src="./js/app.js"></script>

</body>

</html>

==============================================================
File content for: \css\styles.css
==============================================================
/* ========================================
   BASE STYLES
   ======================================== */

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  padding: 20px;
  max-width: 900px;
  margin: 0 auto;
  background: #f5f5f5;
}

h1 {
  color: #333;
  margin-top: 0;
}

h2 {
  color: #00A0D2;
  font-size: 18px;
  margin-top: 0;
}

h3 {
  font-size: 14px;
  color: #666;
  margin: 15px 0 10px 0;
  font-weight: 600;
}

label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: #555;
}

/* ========================================
   UTILITY CLASSES
   ======================================== */

.text-muted {
  color: #999;
}

.text-center {
  text-align: center;
}

/* ========================================
   CARD COMPONENT
   ======================================== */

.card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.info-box {
  background: #e7f3ff;
  border-left: 4px solid #00A0D2;
  padding: 12px;
  margin-bottom: 15px;
  font-size: 14px;
  border-radius: 4px;
}

/* ========================================
   FORM ELEMENTS
   ======================================== */

select,
input[type="checkbox"] {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  margin-bottom: 15px;
}

input[type="checkbox"] {
  width: auto;
  margin-right: 8px;
}

/* ========================================
   BUTTONS
   ======================================== */

button {
  background: #00A0D2;
  color: white;
  padding: 12px 24px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  margin-right: 10px;
  transition: background 0.2s;
}

button:hover {
  background: #0087b5;
}

button.secondary {
  background: #666;
}

button.secondary:hover {
  background: #555;
}

button.success {
  background: #5cb85c;
}

button.success:hover {
  background: #4cae4c;
}

button.danger {
  background: #dc3545;
}

button.danger:hover {
  background: #c82333;
}

button.small {
  padding: 6px 12px;
  font-size: 12px;
}

.icon-btn {
  background: none;
  color: #666;
  padding: 8px;
  width: 36px;
  height: 36px;
  font-size: 18px;
  border-radius: 50%;
}

.icon-btn:hover {
  background: #f0f0f0;
  color: #333;
}

/* ========================================
   STATUS MESSAGES
   ======================================== */

.status {
  padding: 12px;
  border-radius: 4px;
  margin-bottom: 15px;
  display: none;
}

.status.success {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.status.error {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.status.info {
  background: #d1ecf1;
  color: #0c5460;
  border: 1px solid #17a2b8;
}

/* ========================================
   TOGGLE SWITCH
   ======================================== */

.toggle-label {
  display: flex;
  align-items: center;
  margin-bottom: 0;
}

.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
  margin-right: 15px;
  vertical-align: middle;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 34px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: #00A0D2;
}

input:checked + .slider:before {
  transform: translateX(26px);
}

.status-text {
  font-weight: 500;
  font-size: 16px;
}

/* ========================================
   DEVICE SELECTOR (Multi-select)
   ======================================== */

.device-selector-list {
  border: 1px solid #ddd;
  border-radius: 4px;
  max-height: 400px;
  overflow-y: auto;
  margin-bottom: 15px;
  background: white;
}

.zone-group {
  margin-bottom: 0;
}

.zone-group:last-child .zone-devices {
  border-bottom: none;
}

.zone-header {
  background: #00A0D2;
  color: white;
  padding: 12px 15px;
  font-weight: 600;
  font-size: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 10;
}

.zone-header:hover {
  background: #0087b5;
}

.zone-count {
  background: rgba(255, 255, 255, 0.2);
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 12px;
}

.zone-devices {
  display: block;
  background: white;
  border-bottom: 1px solid #ddd;
  padding: 5px 0;
}

.device-checkbox-item {
  padding: 10px 15px 10px 15px;
  cursor: pointer;
  display: flex;
  align-items: center;
  transition: background 0.2s;
}

.device-checkbox-item:hover {
  background: #f0f7fa;
}

.device-checkbox-item input[type="checkbox"] {
  margin-right: 12px;
  margin-bottom: 0;
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.device-checkbox-item label {
  cursor: pointer;
  margin: 0;
  flex: 1;
  font-size: 14px;
  color: #333;
}

/* ========================================
   TRACKED DEVICES LIST (Expandable Cards)
   ======================================== */

.device-list {
  margin-top: 15px;
}

.device-card {
  border: 1px solid #ddd;
  border-radius: 6px;
  margin-bottom: 12px;
  overflow: hidden;
  transition: box-shadow 0.3s;
}

.device-card.expanded {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.device-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px;
  background: white;
  cursor: pointer;
  transition: background 0.2s;
}

.device-header:hover {
  background: #fafafa;
}

.device-info-left {
  flex: 1;
}

.device-name {
  font-weight: 600;
  font-size: 16px;
  color: #333;
  margin-bottom: 4px;
}

.device-stats {
  font-size: 13px;
  color: #666;
}

.device-actions {
  display: flex;
  gap: 8px;
  align-items: center;
}

.menu-btn {
  position: relative;
}

.dropdown-menu {
  position: absolute;
  right: 0;
  top: 100%;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 100;
  min-width: 180px;
  display: none;
  margin-top: 4px;
}

.dropdown-menu.show {
  display: block;
}

.dropdown-item {
  padding: 10px 15px;
  cursor: pointer;
  font-size: 14px;
  border-bottom: 1px solid #f0f0f0;
  transition: background 0.2s;
}

.dropdown-item:last-child {
  border-bottom: none;
}

.dropdown-item:hover {
  background: #f9f9f9;
}

.dropdown-item.danger {
  color: #dc3545;
}

.dropdown-item.danger:hover {
  background: #fff5f5;
}

/* Device Details (Expanded Section) */
.device-details {
  padding: 0 15px 15px 15px;
  border-top: 1px solid #f0f0f0;
  background: #fafafa;
  display: none;
}

.device-details.show {
  display: block;
}

/* ========================================
   TIMELINE VISUALIZATION
   ======================================== */

.timeline-section {
  margin: 15px 0;
}

.timeline-day {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  font-size: 13px;
}

.timeline-label {
  width: 45px;
  font-weight: 600;
  color: #666;
  font-size: 12px;
}

.timeline-bar {
  flex: 1;
  height: 28px;
  background: linear-gradient(to right, #e8e8e8 0%, #e0e0e0 100%);
  border-radius: 14px;
  position: relative;
  overflow: visible;
}

.timeline-event {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 2px solid white;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.timeline-event:hover {
  transform: translateY(-50%) scale(1.4);
  z-index: 10;
}

.timeline-event.on {
  background: #4CAF50;
}

.timeline-event.off {
  background: #f44336;
}

.timeline-times {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  color: #999;
  margin-left: 45px;
  margin-top: 4px;
  padding: 0 4px;
}

.no-events-message {
  padding: 15px;
  text-align: center;
  color: #999;
  font-size: 14px;
}

/* ========================================
   RECENT EVENTS LIST
   ======================================== */

.event-list {
  margin: 15px 0;
}

.event-item {
  display: flex;
  align-items: center;
  padding: 8px 12px;
  background: white;
  border-radius: 4px;
  margin-bottom: 6px;
  font-size: 13px;
}

.event-icon {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  margin-right: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  color: white;
  font-weight: bold;
  flex-shrink: 0;
}

.event-icon.on {
  background: #4CAF50;
}

.event-icon.off {
  background: #f44336;
}

.event-text {
  flex: 1;
}

.event-time {
  color: #999;
  font-size: 12px;
  margin-left: auto;
  white-space: nowrap;
}

/* ========================================
   MODAL
   ======================================== */

.modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.modal-overlay.active {
  display: flex;
}

.modal-content {
  background: white;
  border-radius: 8px;
  padding: 24px;
  max-width: 400px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.modal-content.modal-large {
  max-width: 700px;
  max-height: 80vh;
  overflow-y: auto;
}

.modal-title {
  font-size: 18px;
  font-weight: 600;
  color: #333;
  margin-bottom: 12px;
}

.modal-message {
  color: #666;
  margin-bottom: 20px;
  line-height: 1.5;
  white-space: pre-line;
}

.modal-buttons {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
}

.modal-buttons button {
  margin: 0;
}

.events-modal-content {
  margin-bottom: 20px;
}

.events-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

.events-table th {
  background: #f5f5f5;
  padding: 10px;
  text-align: left;
  font-weight: 600;
  border-bottom: 2px solid #ddd;
}

.events-table td {
  padding: 8px 10px;
  border-bottom: 1px solid #eee;
}

.events-table tr:hover {
  background: #fafafa;
}

/* ========================================
   DEBUG SECTION
   ======================================== */

.debug-section {
  opacity: 0.7;
  margin-top: 40px;
  padding-top: 20px;
  border-top: 2px dashed #ddd;
}

#debugOutput {
  background: #f9f9f9;
  padding: 15px;
  border-radius: 4px;
  font-family: monospace;
  font-size: 12px;
  max-height: 400px;
  overflow-y: auto;
}

.log-controls {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}

.log-controls button {
  flex: 1;
  min-width: 120px;
}

.log-viewer {
  background: #1e1e1e;
  color: #d4d4d4;
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: 12px;
  padding: 15px;
  border-radius: 4px;
  max-height: 500px;
  overflow-y: auto;
  margin-top: 15px;
  user-select: text;
  -webkit-user-select: text;
}

==============================================================
File content for: \js\app.js
==============================================================
/**
 * MAIN APP
 * Application initialization and global state
 */

// ========================================
// CONFIGURATION
// ========================================
const DEBUG = true; // Set to false for production

// ========================================
// GLOBAL STATE
// ========================================
window.availableDevices = [];

/**
 * Initialize app when Homey is ready
 * @param {Object} HomeyAPI - Homey API object
 */
function onHomeyReady(HomeyAPI) {
  // Set global Homey reference
  window.Homey = HomeyAPI;
  
  // Signal that we're ready
  HomeyAPI.ready();

  // Show debug section if enabled
  if (DEBUG) {
    const debugSection = document.getElementById('debugSection');
    if (debugSection) {
      debugSection.style.display = 'block';
    }
    console.log('üêõ DEBUG MODE ENABLED');
  }

  // Load initial data
  console.log('Loading settings...');
  loadSettings();
  
  console.log('Loading devices...');
  loadDevices();
  
  console.log('Loading tracked devices...');
  loadTrackedDevices();

  console.log('‚úÖ Presence Simulator Settings initialized');
  console.log(`Version: ${DEBUG ? 'DEVELOPMENT' : 'PRODUCTION'}`);
}

==============================================================
File content for: \js\debug.js
==============================================================
/**
 * DEBUG FUNCTIONS
 * Development and troubleshooting tools
 */

/**
 * View all events in debug format
 */
async function viewAllEventsDebug() {
  try {
    const response = await Homey.api('GET', '/events');
    const events = response.events || [];
    
    let html = '<h3>All Events (Debug)</h3>';
    html += `<p>Total events: ${events.length}</p>`;
    
    if (events.length === 0) {
      html += '<p class="text-muted">No events recorded</p>';
    } else {
      html += '<table style="width:100%; font-size:11px; border-collapse:collapse;">';
      html += `
        <tr style="background:#f0f0f0;">
          <th style="padding:5px; text-align:left;">Time</th>
          <th style="padding:5px; text-align:left;">Device</th>
          <th style="padding:5px; text-align:left;">Status</th>
          <th style="padding:5px; text-align:left;">Day</th>
        </tr>
      `;
      
      events.slice(0, 100).forEach(event => {
        const date = new Date(event.timestamp);
        const status = event.value ? 'üü¢ ON' : 'üî¥ OFF';
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        html += `
          <tr style="border-bottom:1px solid #eee;">
            <td style="padding:5px;">${formatDateTime(date)}</td>
            <td style="padding:5px;">${escapeHtml(event.deviceName)}</td>
            <td style="padding:5px;">${status}</td>
            <td style="padding:5px;">${days[event.dayOfWeek]}</td>
          </tr>
        `;
      });
      
      html += '</table>';
      
      if (events.length > 100) {
        html += `<p style="margin-top:10px; color:#999;">Showing first 100 of ${events.length} events</p>`;
      }
    }
    
    document.getElementById('debugOutput').innerHTML = html;
  } catch (error) {
    document.getElementById('debugOutput').innerHTML = 
      `<p style="color:red;">Error loading events: ${error.message}</p>`;
  }
}

/**
 * Export all data as JSON
 */
async function exportData() {
  try {
    const events = await Homey.api('GET', '/events');
    const devices = await Homey.get('trackedDevices');
    const history = await Homey.get('deviceHistory');
    const vacationMode = await Homey.get('vacationModeActive');
    
    const data = {
      exportDate: new Date().toISOString(),
      vacationModeActive: vacationMode,
      trackedDevices: devices,
      deviceHistory: history,
      events: events.events
    };
    
    const jsonStr = JSON.stringify(data, null, 2);
    const blob = new Blob([jsonStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `presence-simulator-${Date.now()}.json`;
    a.click();
    URL.revokeObjectURL(url);
    
    showStatus('Data exported successfully', 'success');
  } catch (error) {
    showStatus('Failed to export data: ' + error.message, 'error');
  }
}

/**
 * View application logs
 */
async function viewLogs() {
  const logViewer = document.getElementById('logViewer');

  try {
    const response = await Homey.api('GET', '/logs');
    const logs = response.logs || [];

    if (logs.length === 0) {
      logViewer.innerHTML = '<div style="color: #999;">No logs available</div>';
    } else {
      let html = '';
      // Show newest logs first
      logs.slice().reverse().forEach(log => {
        const levelClass = log.level === 'error' ? 'color: #f48771;' : 'color: #d4d4d4;';
        html += `<div style="margin-bottom: 5px; line-height: 1.4;">`;
        html += `<span style="color: #858585; margin-right: 10px;">${log.timestamp}</span>`;
        html += `<span style="${levelClass}">${escapeHtml(log.message)}</span>`;
        html += `</div>`;
      });
      logViewer.innerHTML = html;
    }

    logViewer.style.display = 'block';
    logViewer.scrollTop = 0;

  } catch (error) {
    showStatus('Failed to load logs: ' + error.message, 'error');
  }
}

/**
 * Toggle auto-refresh for logs
 */
let autoRefreshInterval = null;
let autoRefreshEnabled = false;

function toggleAutoRefresh() {
  autoRefreshEnabled = !autoRefreshEnabled;
  const btn = document.getElementById('autoRefreshBtn');

  if (autoRefreshEnabled) {
    btn.textContent = 'Disable Auto-refresh';
    btn.classList.remove('secondary');
    viewLogs();
    autoRefreshInterval = setInterval(viewLogs, 3000);
  } else {
    btn.textContent = 'Enable Auto-refresh';
    btn.classList.add('secondary');
    if (autoRefreshInterval) {
      clearInterval(autoRefreshInterval);
      autoRefreshInterval = null;
    }
  }
}

/**
 * Clear log display
 */
function clearLogDisplay() {
  const logViewer = document.getElementById('logViewer');
  logViewer.innerHTML = '<div style="color: #999;">Log display cleared (logs still stored in app)</div>';
}

/**
 * Copy logs to clipboard
 */
async function copyLogs() {
  try {
    const response = await Homey.api('GET', '/logs');
    const logs = response.logs || [];

    let text = logs.slice().reverse().map(log => {
      return `${log.timestamp} ${log.message}`;
    }).join('\n');

    await navigator.clipboard.writeText(text);
    showStatus('Logs copied to clipboard!', 'success');
  } catch (error) {
    showStatus('Failed to copy logs: ' + error.message, 'error');
  }
}

==============================================================
File content for: \js\device-selector.js
==============================================================
/**
 * DEVICE SELECTOR FUNCTIONS
 * Handles multi-select device list with zones
 */

let selectedDeviceIds = new Set();

/**
 * Load available devices from Homey
 */
async function loadDevices() {
  try {
    const result = await Homey.api('GET', '/devices');
    const trackedIds = await Homey.get('trackedDevices') || [];

    // Filter to only show devices with onoff capability that aren't already tracked
    window.availableDevices = result.filter(device => {
      return device.capabilitiesObj && 
             device.capabilitiesObj.onoff && 
             !trackedIds.includes(device.id);
    });

    renderDeviceSelector();
  } catch (error) {
    console.error('Load devices error:', error);
    showStatus('Failed to load devices: ' + error.message, 'error');
  }
}

/**
 * Render device selector with zones and checkboxes
 */
function renderDeviceSelector() {
  const container = document.getElementById('deviceSelectorList');

  // Group devices by zone
  const devicesByZone = {};
  window.availableDevices.forEach(device => {
    const zone = device.zoneName || 'No zone';
    if (!devicesByZone[zone]) devicesByZone[zone] = [];
    devicesByZone[zone].push(device);
  });

  const zones = Object.keys(devicesByZone).sort((a, b) => 
    a.localeCompare(b, 'nl', { sensitivity: 'base' })
  );

  if (zones.length === 0) {
    container.innerHTML = '<p style="padding: 15px; color: #999;">All devices are already tracked</p>';
    return;
  }

  let html = '';
  zones.forEach(zoneName => {
    const devices = devicesByZone[zoneName];
    const selectedCount = devices.filter(d => selectedDeviceIds.has(d.id)).length;

    html += `
      <div class="zone-group">
        <div class="zone-header">
          <span>${escapeHtml(zoneName)}</span>
          <span class="zone-count">${selectedCount > 0 ? selectedCount + ' / ' : ''}${devices.length}</span>
        </div>
        <div class="zone-devices">
    `;

    devices.forEach(device => {
      const isChecked = selectedDeviceIds.has(device.id);
      html += `
        <div class="device-checkbox-item">
          <input type="checkbox" 
                 id="dev-${device.id}" 
                 ${isChecked ? 'checked' : ''}
                 onchange="toggleDeviceSelection('${device.id}')">
          <label for="dev-${device.id}">
            ${escapeHtml(device.name)}
          </label>
        </div>
      `;
    });

    html += '</div></div>';
  });

  container.innerHTML = html;
  updateSelectedCount();
}

/**
 * Toggle device selection
 * @param {string} deviceId - Device ID
 */
function toggleDeviceSelection(deviceId) {
  if (selectedDeviceIds.has(deviceId)) {
    selectedDeviceIds.delete(deviceId);
  } else {
    selectedDeviceIds.add(deviceId);
  }
  updateSelectedCount();
}

/**
 * Update selected device counter
 */
function updateSelectedCount() {
  document.getElementById('selectedCount').textContent = selectedDeviceIds.size;
}

/**
 * Add selected devices to tracking
 */
async function addSelectedDevices() {
  if (selectedDeviceIds.size === 0) {
    showStatus('Please select at least one device', 'error');
    return;
  }

  try {
    for (const deviceId of selectedDeviceIds) {
      await Homey.api('POST', '/track', { deviceId });
    }

    showStatus(`Successfully added ${selectedDeviceIds.size} device(s)`, 'success');
    selectedDeviceIds.clear();
    await loadDevices();
    await loadTrackedDevices();
  } catch (error) {
    showStatus('Failed to add devices: ' + error.message, 'error');
  }
}

==============================================================
File content for: \js\modals.js
==============================================================
/**
 * MODAL FUNCTIONS
 * Handles confirmation modals and other dialogs
 */

// Modal state (global)
if (typeof modalResolve === 'undefined') {
  var modalResolve = null;
}

/**
 * Show confirmation modal
 * @param {string} title - Modal title
 * @param {string} message - Modal message
 * @returns {Promise<boolean>} True if confirmed, false if cancelled
 */
function showConfirmModal(title, message) {
  return new Promise((resolve) => {
    modalResolve = resolve;
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalMessage').textContent = message;
    document.getElementById('confirmModal').classList.add('active');
  });
}

/**
 * Close modal and resolve promise
 * @param {boolean} confirmed - Whether user confirmed or cancelled
 */
function closeModal(confirmed) {
  document.getElementById('confirmModal').classList.remove('active');
  if (modalResolve) {
    modalResolve(confirmed);
    modalResolve = null;
  }
}

==============================================================
File content for: \js\settings.js
==============================================================
/**
 * SETTINGS FUNCTIONS
 * Handles vacation mode toggle and app settings
 */

/**
 * Load settings from Homey
 */
async function loadSettings() {
  try {
    const vacationMode = await Homey.get('vacationModeActive');
    document.getElementById('vacationMode').checked = vacationMode || false;
    updateVacationStatus(vacationMode || false);
  } catch (error) {
    console.error('Error loading settings:', error);
  }
}

/**
 * Toggle vacation mode on/off
 */
async function toggleVacationMode() {
  try {
    const checkbox = document.getElementById('vacationMode');
    const newState = checkbox.checked;

    await Homey.set('vacationModeActive', newState);
    await Homey.api('POST', '/reload-settings');

    updateVacationStatus(newState);
    showStatus(`Simulator ${newState ? 'enabled' : 'disabled'}`, 'success');
  } catch (error) {
    // Revert checkbox on error
    checkbox.checked = !checkbox.checked;
    showStatus('Failed to toggle simulator: ' + error.message, 'error');
  }
}

/**
 * Update vacation status display
 * @param {boolean} isActive - Whether vacation mode is active
 */
function updateVacationStatus(isActive) {
  const statusElement = document.getElementById('vacationStatus');
  statusElement.textContent = isActive ? 'ON' : 'OFF';
  statusElement.style.color = isActive ? '#4CAF50' : '#f44336';
}

==============================================================
File content for: \js\test-data.js
==============================================================
/**
 * TEST DATA FUNCTIONS
 * Handles generation of test data for devices
 */

/**
 * Generate test data for selected devices
 */
async function generateTestDataForSelected() {
  if (selectedDeviceIds.size === 0) {
    showStatus('Please select at least one device', 'error');
    return;
  }

  const confirmed = await showConfirmModal(
    'Generate Test Data',
    `Generate realistic test data for ${selectedDeviceIds.size} device(s)?\n\nThis will create on/off events for the past 7 days.`
  );

  if (!confirmed) return;

  try {
    let totalEvents = 0;
    
    for (const deviceId of selectedDeviceIds) {
      const result = await Homey.api('POST', '/generate-test-data', { deviceId });
      totalEvents += result.eventsGenerated;
    }

    showStatus(
      `‚úì Generated ${totalEvents} events for ${selectedDeviceIds.size} device(s)`, 
      'success'
    );
    
    await loadTrackedDevices();
  } catch (error) {
    showStatus('Failed to generate test data: ' + error.message, 'error');
  }
}

==============================================================
File content for: \js\tracked-devices.js
==============================================================
/**
 * TRACKED DEVICES FUNCTIONS
 * Handles the list of tracked devices with expandable cards and timeline
 */

let expandedDevices = new Set();

/**
 * Load and display tracked devices
 */
async function loadTrackedDevices() {
  try {
    const deviceIds = await Homey.get('trackedDevices');
    if (!deviceIds || deviceIds.length === 0) {
      document.getElementById('trackedDevices').innerHTML = 
        '<p class="text-muted">No devices tracked yet</p>';
      return;
    }

    const allDevices = await Homey.api('GET', '/devices');
    const eventsData = await Homey.api('GET', '/events');
    const container = document.getElementById('trackedDevices');
    container.innerHTML = '';

    for (const deviceId of deviceIds) {
      const device = allDevices.find(d => d.id === deviceId);
      if (!device) continue;

      const deviceEvents = eventsData.events.filter(e => e.deviceId === deviceId);
      const eventCount = deviceEvents.length;
      const lastEvent = deviceEvents.length > 0 ? deviceEvents[0] : null;
      const lastEventTime = lastEvent ? formatRelativeTime(lastEvent.timestamp) : 'never';

      const cardHtml = renderDeviceCard(device, deviceId, eventCount, lastEventTime, deviceEvents);
      container.insertAdjacentHTML('beforeend', cardHtml);
    }

  } catch (error) {
    console.error('Error loading tracked devices:', error);
  }
}

/**
 * Render device card with header and expandable details
 */
function renderDeviceCard(device, deviceId, eventCount, lastEventTime, events) {
  const isExpanded = expandedDevices.has(deviceId);
  
  return `
    <div class="device-card ${isExpanded ? 'expanded' : ''}" id="card-${deviceId}">
      <div class="device-header" onclick="toggleDeviceCard('${deviceId}', event)">
        <div class="device-info-left">
          <div class="device-name">${escapeHtml(device.name)}</div>
          <div class="device-stats">${eventCount} events ‚Ä¢ Last: ${lastEventTime}</div>
        </div>
        <div class="device-actions">
          <button class="icon-btn menu-btn" onclick="toggleDeviceMenu(event, '${deviceId}')">‚ãÆ</button>
          <div id="menu-${deviceId}" class="dropdown-menu">
            <div class="dropdown-item" onclick="generateTestDataForDevice('${deviceId}', '${escapeHtml(device.name)}')">
              üß™ Generate Test Data
            </div>
            <div class="dropdown-item" onclick="viewDeviceEvents('${deviceId}', '${escapeHtml(device.name)}')">
              üìä View All Events
            </div>
            <div class="dropdown-item" onclick="clearDeviceHistory('${deviceId}', '${escapeHtml(device.name)}')">
              üóëÔ∏è Clear History
            </div>
            <div class="dropdown-item danger" onclick="removeDeviceById('${deviceId}')">
              ‚ùå Remove Device
            </div>
          </div>
        </div>
      </div>
      <div class="device-details ${isExpanded ? 'show' : ''}" id="details-${deviceId}">
        ${renderDeviceTimeline(events)}
        ${renderRecentEvents(events)}
      </div>
    </div>
  `;
}

/**
 * Render timeline visualization
 */
function renderDeviceTimeline(events) {
  if (events.length === 0) {
    return '<div class="no-events-message">No events recorded yet</div>';
  }

  // Group events by day of week
  const eventsByDay = {};
  const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  
  events.forEach(event => {
    const day = days[event.dayOfWeek];
    if (!eventsByDay[day]) eventsByDay[day] = [];
    eventsByDay[day].push(event);
  });

  let html = '<div class="timeline-section"><h3>üìä Weekly Pattern</h3>';
  
  // Render timeline for each day
  days.forEach(day => {
    const dayEvents = eventsByDay[day] || [];
    html += `<div class="timeline-day">
      <div class="timeline-label">${day}</div>
      <div class="timeline-bar">`;
    
    // Add event dots
    dayEvents.forEach(event => {
      const position = (event.timeMinutes / 1440) * 100; // 1440 = minutes in a day
      const eventClass = event.value ? 'on' : 'off';
      const time = formatTime(event.hourOfDay, event.minuteOfHour);
      const status = event.value ? 'ON' : 'OFF';
      html += `<div class="timeline-event ${eventClass}" 
                    style="left: ${position}%"
                    title="${time} - ${status}"></div>`;
    });
    
    html += `</div></div>`;
  });

  // Add time labels
  html += `
    <div class="timeline-times">
      <span>00:00</span>
      <span>06:00</span>
      <span>12:00</span>
      <span>18:00</span>
      <span>24:00</span>
    </div>
  `;
  html += '</div>';
  
  return html;
}

/**
 * Render recent events list
 */
function renderRecentEvents(events) {
  if (events.length === 0) return '';

  // Take last 10 events (already sorted newest first from API)
  const recentEvents = events.slice(0, 10);

  let html = '<div class="event-list"><h3>üìã Recent Events</h3>';
  
  recentEvents.forEach(event => {
    const date = new Date(event.timestamp);
    const timeStr = formatDateTime(date);
    const iconClass = event.value ? 'on' : 'off';
    const statusText = event.value ? 'ON' : 'OFF';
    
    html += `
      <div class="event-item">
        <div class="event-icon ${iconClass}">${event.value ? '‚óè' : '‚óã'}</div>
        <div class="event-text">${statusText}</div>
        <div class="event-time">${timeStr}</div>
      </div>
    `;
  });
  
  html += '</div>';
  return html;
}

/**
 * Toggle device card expanded/collapsed
 */
function toggleDeviceCard(deviceId, event) {
  // Don't toggle if clicking on menu button
  if (event && event.target.closest('.menu-btn')) {
    return;
  }

  const card = document.getElementById('card-' + deviceId);
  const details = document.getElementById('details-' + deviceId);
  
  if (expandedDevices.has(deviceId)) {
    expandedDevices.delete(deviceId);
    card.classList.remove('expanded');
    details.classList.remove('show');
  } else {
    expandedDevices.add(deviceId);
    card.classList.add('expanded');
    details.classList.add('show');
  }
}

/**
 * Toggle device menu dropdown
 */
function toggleDeviceMenu(event, deviceId) {
  event.stopPropagation();
  
  const menu = document.getElementById('menu-' + deviceId);
  const isVisible = menu.classList.contains('show');
  
  // Close all other menus
  document.querySelectorAll('.dropdown-menu').forEach(m => {
    m.classList.remove('show');
  });
  
  // Toggle this menu
  if (!isVisible) {
    menu.classList.add('show');
  }
}

// Close menus when clicking outside
document.addEventListener('click', (e) => {
  if (!e.target.closest('.menu-btn')) {
    document.querySelectorAll('.dropdown-menu').forEach(m => {
      m.classList.remove('show');
    });
  }
});

/**
 * View all events for a device in modal
 */
async function viewDeviceEvents(deviceId, deviceName) {
  try {
    const eventsData = await Homey.api('GET', '/events');
    const deviceEvents = eventsData.events.filter(e => e.deviceId === deviceId);
    
    let html = `<p style="color: #666; margin-bottom: 15px;">Showing all ${deviceEvents.length} events for ${deviceName}</p>`;
    
    if (deviceEvents.length === 0) {
      html += '<p class="text-muted">No events recorded yet</p>';
    } else {
      html += '<table class="events-table">';
      html += `
        <thead>
          <tr>
            <th>Time</th>
            <th>Status</th>
            <th>Day</th>
          </tr>
        </thead>
        <tbody>
      `;
      
      deviceEvents.forEach(event => {
        const date = new Date(event.timestamp);
        const timeStr = formatDateTime(date);
        const statusColor = event.value ? '#4CAF50' : '#f44336';
        const statusText = event.value ? 'üü¢ ON' : 'üî¥ OFF';
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const dayName = days[event.dayOfWeek];
        
        html += `
          <tr>
            <td>${timeStr}</td>
            <td style="color: ${statusColor}; font-weight: bold;">${statusText}</td>
            <td>${dayName}</td>
          </tr>
        `;
      });
      
      html += '</tbody></table>';
    }
    
    document.getElementById('eventsModalTitle').textContent = `Events: ${deviceName}`;
    document.getElementById('eventsModalContent').innerHTML = html;
    document.getElementById('eventsModal').classList.add('active');
  } catch (error) {
    showStatus('Failed to load events: ' + error.message, 'error');
  }
}

/**
 * Close events modal
 */
function closeEventsModal() {
  document.getElementById('eventsModal').classList.remove('active');
}

/**
 * Clear history for a specific device
 */
async function clearDeviceHistory(deviceId, deviceName) {
  const confirmed = await showConfirmModal(
    'Clear History',
    `Delete all recorded events for "${deviceName}"?\n\nThis cannot be undone, but tracking will continue.`
  );

  if (!confirmed) return;

  try {
    // Get current history
    const history = await Homey.get('deviceHistory');
    
    // Remove this device's history
    if (history && history[deviceId]) {
      delete history[deviceId];
      await Homey.set('deviceHistory', history);
    }

    showStatus('History cleared for ' + deviceName, 'success');
    await loadTrackedDevices();
  } catch (error) {
    showStatus('Failed to clear history: ' + error.message, 'error');
  }
}

/**
 * Remove device from tracking
 */
async function removeDeviceById(deviceId) {
  try {
    const allDevices = await Homey.api('GET', '/devices');
    const device = allDevices.find(d => d.id === deviceId);
    const deviceName = device ? device.name : deviceId;

    const confirmed = await showConfirmModal(
      'Remove Device',
      `Remove "${deviceName}" from tracking?\n\nHistory will be preserved unless you clear it separately.`
    );

    if (!confirmed) return;

    await Homey.api('POST', '/untrack', { deviceId });
    showStatus('Device removed', 'success');
    
    // Reload both lists
    await loadDevices();
    await loadTrackedDevices();
  } catch (error) {
    showStatus('Failed to remove device: ' + error.message, 'error');
  }
}

/**
 * Generate test data for a single device
 */
async function generateTestDataForDevice(deviceId, deviceName) {
  const confirmed = await showConfirmModal(
    'Generate Test Data',
    `Generate realistic test data for "${deviceName}"?\n\nThis will create on/off events for the past 7 days.`
  );

  if (!confirmed) return;

  try {
    const result = await Homey.api('POST', '/generate-test-data', { deviceId });
    
    showStatus(
      `‚úì Generated ${result.eventsGenerated} events for ${deviceName}`, 
      'success'
    );
    
    await loadTrackedDevices();
  } catch (error) {
    showStatus('Failed to generate test data: ' + error.message, 'error');
  }
}

==============================================================
File content for: \js\utils.js
==============================================================
/**
 * UTILITY FUNCTIONS
 * General helper functions used across the app
 */

/**
 * Escape HTML to prevent XSS
 * @param {string} text - Text to escape
 * @returns {string} Escaped HTML
 */
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

/**
 * Show status message
 * @param {string} message - Message to display
 * @param {string} type - Type: 'success', 'error', 'info'
 */
function showStatus(message, type) {
  const status = document.getElementById('statusMessage');
  status.textContent = message;
  status.className = 'status ' + type;
  status.style.display = 'block';

  setTimeout(() => {
    status.style.display = 'none';
  }, 5000);
}

/**
 * Format date/time for display
 * @param {Date} date - Date object
 * @returns {string} Formatted date string
 */
function formatDateTime(date) {
  return date.toLocaleString('nl-NL', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit'
  });
}

/**
 * Format time only
 * @param {number} hours - Hours
 * @param {number} minutes - Minutes
 * @returns {string} Formatted time string
 */
function formatTime(hours, minutes) {
  return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
}

/**
 * Format relative time (e.g., "2 hours ago")
 * @param {number} timestamp - Unix timestamp in milliseconds
 * @returns {string} Relative time string
 */
function formatRelativeTime(timestamp) {
  const now = Date.now();
  const diff = now - timestamp;
  
  const seconds = Math.floor(diff / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  const days = Math.floor(hours / 24);
  
  if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;
  if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
  if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
  return 'just now';
}

