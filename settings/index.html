<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Presence Simulator Settings</title>
  <script type="text/javascript" src="/homey.js" data-origin="settings"></script>
  <link rel="stylesheet" href="./css/styles.css">
</head>

<body>

  <h1 data-i18n="settings.pageTitle">Presence Simulator Settings</h1>

  <div id="statusMessage" class="status"></div>

  <!-- Confirm Modal -->
  <div id="confirmModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-title" id="modalTitle">Confirm</div>
      <div class="modal-message" id="modalMessage"></div>
      <div class="modal-buttons">
        <button class="secondary" onclick="closeModal(false)" data-i18n="settings.cancel">Cancel</button>
        <button onclick="closeModal(true)" data-i18n="settings.confirm">Confirm</button>
      </div>
    </div>
  </div>

  <!-- All Events Modal -->
  <div id="eventsModal" class="modal-overlay">
    <div class="modal-content modal-large">
      <div class="modal-title" id="eventsModalTitle" data-i18n="settings.allEventsTitle">All Events</div>
      <div id="eventsModalContent" class="events-modal-content"></div>
      <div class="modal-buttons">
        <button onclick="closeEventsModal()" data-i18n="settings.close">Close</button>
      </div>
    </div>
  </div>

  <!-- Vacation Mode Toggle -->
  <div class="card">
    <h2 data-i18n="settings.presenceSimulator">Presence Simulator</h2>
    <div class="info-box" data-i18n="settings.infoSimulator">
      Enable Presence Simulator to start replaying recorded patterns
    </div>
    <label class="toggle-label">
      <label class="switch">
        <input type="checkbox" id="vacationMode" onchange="toggleVacationMode()">
        <span class="slider"></span>
      </label>
      <span class="status-text"><span data-i18n="settings.simulatorIs">Simulator is</span> <span
          id="vacationStatus">OFF</span></span>
    </label>
  </div>

  <!-- Add Devices -->
  <div class="card">
    <h2 data-i18n="settings.addDevices">Add Devices to Track</h2>
    <div class="info-box" data-i18n="settings.infoAddDevices">
      Select one or more devices to start tracking their on/off patterns
    </div>
    <div id="deviceSelectorList" class="device-selector-list"></div>


    <!-- âœ… NIEUW: Import optie VAST bij de knop -->

    <div class="import-history" style="display: flex; align-items: flex-start; gap: 10px;">
      <input type="checkbox" id="importHistoryOnAdd" checked style="margin-top: 3px; width: auto; flex-shrink: 0;">
      <div class="import-history-note">
        <strong data-i18n="settings.checkboxImport">Importeer laatste events bij toevoegen</strong><br>
        <div data-i18n="settings.checkboxImportNote">Haalt max. 50 recente aan/uit events op uit Homey Insights</div>
      </div>

    </div>

    <button onclick="addSelectedDevices()">
      <span data-i18n="settings.addSelectedDevices">Add Selected Devices</span>
      (<span id="selectedCount">0</span>)
    </button>
  </div>

  <!-- Tracked Devices -->
  <div class="card">
    <h2 data-i18n="settings.trackedDevices">Tracked Devices</h2>
    <div id="trackedDevices" class="device-list">
      <p class="text-muted" data-i18n="settings.noDevicesTracked">No devices tracked yet</p>
    </div>
  </div>

  <!-- Debug Section -->
  <div id="debugSection" class="debug-section" style="display: none;">
    <div class="card">
      <h2 data-i18n="settings.debugTools">Debug Tools</h2>
      <div class="info-box" data-i18n="settings.infoDebugTools">
        Development tools for troubleshooting
      </div>
      <button onclick="viewAllEventsDebug()" data-i18n="settings.viewAllEvents">View All Events</button>
      <button onclick="exportData()" class="secondary" data-i18n="settings.exportData">Export Data</button>
      <div id="debugOutput" style="margin-top: 15px;"></div>
    </div>

    <div class="card">
      <h2 data-i18n="settings.applicationLogs">Application Logs</h2>
      <div class="info-box" data-i18n="settings.infoLogs">
        View real-time application logs for debugging
      </div>
      <div class="log-controls">
        <button onclick="viewLogs()" data-i18n="settings.refreshLogs">Refresh Logs</button>
        <button onclick="toggleAutoRefresh()" id="autoRefreshBtn" class="secondary"
          data-i18n="settings.enableAutoRefresh">Enable Auto-refresh</button>
        <button onclick="clearLogDisplay()" class="secondary" data-i18n="settings.clearDisplay">Clear Display</button>
        <button onclick="copyLogs()" class="secondary" data-i18n="settings.copyLogs">Copy Logs</button>
      </div>
      <div id="logViewer" class="log-viewer" style="display: none;"></div>
    </div>
  </div>

  <!-- Scripts - LOAD IN ORDER -->
  <!-- 1. Utilities first -->
  <script src="./js/utils.js"></script>
  <script src="./js/modals.js"></script>
  <!-- 2. Then feature modules -->
  <script src="./js/settings.js"></script>
  <script src="./js/device-selector.js"></script>
  <script src="./js/tracked-devices.js"></script>
  <script src="./js/test-data.js"></script>
  <script src="./js/debug.js"></script>
  <!-- 3. Finally app.js which initializes everything -->
  <script src="./js/app.js"></script>

</body>

</html>